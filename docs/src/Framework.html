<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span></span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span></span><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Framework</span><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-4"></a><span></span><span>
</span><a name="line-5"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IORef</span><span></span><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span><span></span><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">Socket</span><span></span><span>
</span><a name="line-8"></a><span class="hs-comment">-- import Network.WebSocket</span><span>
</span><a name="line-9"></a><span></span><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><a href="Mimizu.html"><span class="hs-identifier">Mimizu</span></a><span></span><span>
</span><a name="line-11"></a><span></span><span>
</span><a name="line-12"></a><span class="hs-comment">-- hostAddress :: (Word8, Word8, Word8, Word8)</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- hostAddress = tupleToHostAddress (160, 16, 82, 222)</span><span>
</span><a name="line-14"></a><span></span><span>
</span><a name="line-15"></a><span class="hs-identifier">toAddrString</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span></span><span>
</span><a name="line-16"></a><a name="toAddrString"><a href="Framework.html#toAddrString"><span class="hs-identifier">toAddrString</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679038643"><a href="#local-6989586621679038643"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679038644"><a href="#local-6989586621679038644"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679038645"><a href="#local-6989586621679038645"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679038646"><a href="#local-6989586621679038646"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679038643"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679038644"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679038645"><span class="hs-identifier hs-var">z</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679038646"><span class="hs-identifier hs-var">w</span></a><span></span><span>
</span><a name="line-17"></a><span></span><span>
</span><a name="line-18"></a><span class="hs-identifier">gamePort</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">PortNumber</span><span></span><span>
</span><a name="line-19"></a><a name="gamePort"><a href="Framework.html#gamePort"><span class="hs-identifier">gamePort</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">8888</span><span></span><span>
</span><a name="line-20"></a><span></span><span>
</span><a name="line-21"></a><span class="hs-identifier">chatPort</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">PortNumber</span><span></span><span>
</span><a name="line-22"></a><a name="chatPort"><a href="Framework.html#chatPort"><span class="hs-identifier">chatPort</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">8891</span><span></span><span>
</span><a name="line-23"></a><span></span><span>
</span><a name="line-24"></a><span class="hs-comment">-- gameHostAddr :: SockAddr</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- gameHostAddr = SocketAddr Inet gamePort hostAddress</span><span>
</span><a name="line-26"></a><span></span><span>
</span><a name="line-27"></a><span class="hs-comment">-- chatHostAddr :: SockAddr</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- chatHostAddr = SocketAddr Inet chatPort hostAddress</span><span>
</span><a name="line-29"></a><span></span><span>
</span><a name="line-30"></a><span class="hs-comment">-- ^ Current list of players, may or may not be upto dated depending on the distance from you</span><span>
</span><a name="line-31"></a><span class="hs-comment">--   Current list of food blocks, it will not be upto dated for the block where the block you are not in.</span><span>
</span><a name="line-32"></a><span class="hs-comment">--   Action.</span><span>
</span><a name="line-33"></a><span></span><span>
</span><a name="line-34"></a><span class="hs-keyword">type</span><span> </span><a name="GameAngle"><a href="Framework.html#GameAngle"><span class="hs-identifier">GameAngle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Word16</span><span> </span><span class="hs-comment">-- ^ Must be in range 0 ~ 4096</span><span>
</span><a name="line-35"></a><span class="hs-keyword">type</span><span> </span><a name="DashFlag"><a href="Framework.html#DashFlag"><span class="hs-identifier">DashFlag</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>   </span><span class="hs-comment">-- ^ True if dash is on, False otherwise</span><span>
</span><a name="line-36"></a><span></span><span>
</span><a name="line-37"></a><span class="hs-keyword">type</span><span> </span><a name="GameReceiveCallback"><a href="Framework.html#GameReceiveCallback"><span class="hs-identifier">GameReceiveCallback</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><span> </span><a href="Mimizu.Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><span> </span><a href="Mimizu.Food.html#FoodBlock"><span class="hs-identifier hs-type">FoodBlock</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Framework.html#DashFlag"><span class="hs-identifier hs-type">DashFlag</span></a><span class="hs-special">,</span><span> </span><a href="Framework.html#GameAngle"><span class="hs-identifier hs-type">GameAngle</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-38"></a><span></span><span>
</span><a name="line-39"></a><span class="hs-comment">-- consider to use StorableArray Index a</span><span>
</span><a name="line-40"></a><span class="hs-keyword">type</span><span> </span><a name="MutablePlayerList"><a href="Framework.html#MutablePlayerList"><span class="hs-identifier">MutablePlayerList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="Mimizu.Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-41"></a><span class="hs-keyword">type</span><span> </span><a name="MutableFoodList"><a href="Framework.html#MutableFoodList"><span class="hs-identifier">MutableFoodList</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="Mimizu.Food.html#FoodBlock"><span class="hs-identifier hs-type">FoodBlock</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-42"></a><span class="hs-keyword">type</span><span> </span><a name="PlayerID"><a href="Framework.html#PlayerID"><span class="hs-identifier">PlayerID</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span></span><span>
</span><a name="line-43"></a><span></span><span>
</span><a name="line-44"></a><span class="hs-identifier">pullIORefs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="#local-6989586621679036802"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679036802"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-45"></a><a name="pullIORefs"><a href="Framework.html#pullIORefs"><span class="hs-identifier">pullIORefs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Framework.html#eliminateIORef"><span class="hs-identifier hs-var">eliminateIORef</span></a><span></span><span>
</span><a name="line-46"></a><span></span><span>
</span><a name="line-47"></a><span class="hs-comment">{-
run :: GameReceiveCallback -&gt; ClientApp ()
run cb conn = do
  players &lt;- newIORef [] :: IO MutablePlayerList
  foods &lt;- newIORef [] :: IO MutableFoodList
  putStrLn &quot; Game socket: Connected&quot;
  sendData conn yourPID
  _ &lt;- forkIO $ forever $ do
    msg &lt;- receiveData conn
    parseGameData players foods msg
    players' &lt;- readIORef players
    foods'   &lt;- readIORef foods
    act      &lt;- cb players foods
    sendData conn act
  forever (return ())


mainLoop :: GameReceiveCallback -&gt; IO ()
mainLoop cb = withSocketsDo $ runClient (toAddrString hostAddress) gamePort (run cb)
-}</span><span></span><span>
</span><a name="line-67"></a><span class="hs-identifier">eliminateIORef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="#local-6989586621679036801"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679036801"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-68"></a><a name="eliminateIORef"><a href="Framework.html#eliminateIORef"><span class="hs-identifier">eliminateIORef</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679039023"><a href="#local-6989586621679039023"><span class="hs-identifier">idx</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679039024"><a href="#local-6989586621679039024"><span class="hs-identifier">ref</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679039023"><span class="hs-identifier hs-var">idx</span></a><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">readIORef</span><span> </span><a href="#local-6989586621679039024"><span class="hs-identifier hs-var">ref</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-69"></a><span></span><span>
</span><a name="line-70"></a><span class="hs-identifier">parsePlayer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">parseAction</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">parseDeath</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Framework.html#MutablePlayerList"><span class="hs-identifier hs-type">MutablePlayerList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-71"></a><a name="parseAction"><a href="Framework.html#parseAction"><span class="hs-identifier">parseAction</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">undefined</span><span></span><span>
</span><a name="line-72"></a><a name="parseDeath"><a href="Framework.html#parseDeath"><span class="hs-identifier">parseDeath</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">undefined</span><span></span><span>
</span><a name="line-73"></a><a name="parsePlayer"><a href="Framework.html#parsePlayer"><span class="hs-identifier">parsePlayer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">undefined</span><span></span><span>
</span><a name="line-74"></a><span></span><span>
</span><a name="line-75"></a><span class="hs-identifier">parseFood</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Framework.html#MutableFoodList"><span class="hs-identifier hs-type">MutableFoodList</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-76"></a><a name="parseFood"><a href="Framework.html#parseFood"><span class="hs-identifier">parseFood</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">undefined</span><span></span><span>
</span><a name="line-77"></a><span></span><span>
</span><a name="line-78"></a><span class="hs-identifier">parseNumber</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="Mimizu.Util.html#Index"><span class="hs-identifier hs-type">Index</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-79"></a><a name="parseNumber"><a href="Framework.html#parseNumber"><span class="hs-identifier">parseNumber</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">undefined</span><span></span><span>
</span><a name="line-80"></a><span></span><span>
</span><a name="line-81"></a><span class="hs-comment">-- ^ A tag for parsing data</span><span>
</span><a name="line-82"></a><span class="hs-identifier">playerParseTag</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">actionParseTag</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">foodParseTag</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">deathParseTag</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">numberParseTag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span></span><span>
</span><a name="line-83"></a><span></span><span>
</span><a name="line-84"></a><a name="playerParseTag"><a href="Framework.html#playerParseTag"><span class="hs-identifier">playerParseTag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Mimizu.Util.html#intToWord8"><span class="hs-identifier hs-var">intToWord8</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-char">'P'</span><span></span><span>
</span><a name="line-85"></a><a name="actionParseTag"><a href="Framework.html#actionParseTag"><span class="hs-identifier">actionParseTag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Mimizu.Util.html#intToWord8"><span class="hs-identifier hs-var">intToWord8</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-char">'A'</span><span></span><span>
</span><a name="line-86"></a><a name="foodParseTag"><a href="Framework.html#foodParseTag"><span class="hs-identifier">foodParseTag</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Mimizu.Util.html#intToWord8"><span class="hs-identifier hs-var">intToWord8</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-char">'F'</span><span></span><span>
</span><a name="line-87"></a><a name="deathParseTag"><a href="Framework.html#deathParseTag"><span class="hs-identifier">deathParseTag</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Mimizu.Util.html#intToWord8"><span class="hs-identifier hs-var">intToWord8</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-char">'D'</span><span></span><span>
</span><a name="line-88"></a><a name="numberParseTag"><a href="Framework.html#numberParseTag"><span class="hs-identifier">numberParseTag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Mimizu.Util.html#intToWord8"><span class="hs-identifier hs-var">intToWord8</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-char">'N'</span><span></span><span>
</span><a name="line-89"></a><span></span><span>
</span><a name="line-90"></a><span class="hs-identifier">parseGameData</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Framework.html#PlayerID"><span class="hs-identifier hs-type">PlayerID</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Framework.html#MutablePlayerList"><span class="hs-identifier hs-type">MutablePlayerList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Framework.html#MutableFoodList"><span class="hs-identifier hs-type">MutableFoodList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-91"></a><a name="parseGameData"><a href="Framework.html#parseGameData"><span class="hs-identifier">parseGameData</span></a></a><span> </span><a name="local-6989586621679039025"><a href="#local-6989586621679039025"><span class="hs-identifier">pid</span></a></a><span> </span><a name="local-6989586621679039026"><a href="#local-6989586621679039026"><span class="hs-identifier">players</span></a></a><span> </span><a name="local-6989586621679039027"><a href="#local-6989586621679039027"><span class="hs-identifier">foods</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679039028"><a href="#local-6989586621679039028"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679039029"><a href="#local-6989586621679039029"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-92"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679039028"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Framework.html#playerParseTag"><span class="hs-identifier hs-var">playerParseTag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span></span><span>
</span><a name="line-93"></a><span>         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679039030"><a href="#local-6989586621679039030"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span></span><span>
</span><a name="line-94"></a><span>             </span><a name="local-6989586621679039031"><a href="#local-6989586621679039031"><span class="hs-identifier">idx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Mimizu.Util.html#integralToIndex"><span class="hs-identifier hs-var">integralToIndex</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-number">1</span><span></span><span>
</span><a name="line-95"></a><span>         </span><a href="Framework.html#parsePlayer"><span class="hs-identifier hs-var">parsePlayer</span></a><span> </span><a href="#local-6989586621679039026"><span class="hs-identifier hs-var">players</span></a><span> </span><a href="#local-6989586621679039031"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621679039030"><span class="hs-identifier hs-var">len</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-96"></a><span>         </span><a href="Framework.html#parseGameData"><span class="hs-identifier hs-var">parseGameData</span></a><span> </span><a href="#local-6989586621679039025"><span class="hs-identifier hs-var">pid</span></a><span> </span><a href="#local-6989586621679039026"><span class="hs-identifier hs-var">players</span></a><span> </span><a href="#local-6989586621679039027"><span class="hs-identifier hs-var">foods</span></a><span> </span><span class="hs-operator hs-var">$</span><span>  </span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679039030"><span class="hs-identifier hs-var">len</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span></span><span>
</span><a name="line-97"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679039028"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Framework.html#foodParseTag"><span class="hs-identifier hs-var">foodParseTag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span></span><span>
</span><a name="line-98"></a><span>         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679039032"><a href="#local-6989586621679039032"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-number">2</span><span></span><span>
</span><a name="line-99"></a><span>             </span><a name="local-6989586621679039033"><a href="#local-6989586621679039033"><span class="hs-identifier">idx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Mimizu.Util.html#integralToIndex"><span class="hs-identifier hs-var">integralToIndex</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Mimizu.Util.html#conv8To16"><span class="hs-identifier hs-var">conv8To16</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span></span><span>
</span><a name="line-100"></a><span>         </span><a href="Framework.html#parseFood"><span class="hs-identifier hs-var">parseFood</span></a><span> </span><a href="#local-6989586621679039027"><span class="hs-identifier hs-var">foods</span></a><span> </span><a href="#local-6989586621679039033"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679039032"><span class="hs-identifier hs-var">len</span></a><span class="hs-operator hs-var">*</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span></span><span>
</span><a name="line-101"></a><span>         </span><a href="Framework.html#parseGameData"><span class="hs-identifier hs-var">parseGameData</span></a><span> </span><a href="#local-6989586621679039025"><span class="hs-identifier hs-var">pid</span></a><span> </span><a href="#local-6989586621679039026"><span class="hs-identifier hs-var">players</span></a><span> </span><a href="#local-6989586621679039027"><span class="hs-identifier hs-var">foods</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679039032"><span class="hs-identifier hs-var">len</span></a><span class="hs-operator hs-var">*</span><span class="hs-number">2</span><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-operator hs-var">+</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span></span><span>
</span><a name="line-102"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679039028"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Framework.html#actionParseTag"><span class="hs-identifier hs-var">actionParseTag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span></span><span>
</span><a name="line-103"></a><span>         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679039034"><a href="#local-6989586621679039034"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span></span><span>
</span><a name="line-104"></a><span>             </span><a name="local-6989586621679039035"><a href="#local-6989586621679039035"><span class="hs-identifier">idx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Mimizu.Util.html#integralToIndex"><span class="hs-identifier hs-var">integralToIndex</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-number">1</span><span></span><span>
</span><a name="line-105"></a><span>         </span><a href="Framework.html#parseAction"><span class="hs-identifier hs-var">parseAction</span></a><span> </span><a href="#local-6989586621679039026"><span class="hs-identifier hs-var">players</span></a><span> </span><a href="#local-6989586621679039035"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679039034"><span class="hs-identifier hs-var">len</span></a><span class="hs-operator hs-var">*</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-106"></a><span>         </span><a href="Framework.html#parseGameData"><span class="hs-identifier hs-var">parseGameData</span></a><span> </span><a href="#local-6989586621679039025"><span class="hs-identifier hs-var">pid</span></a><span> </span><a href="#local-6989586621679039026"><span class="hs-identifier hs-var">players</span></a><span> </span><a href="#local-6989586621679039027"><span class="hs-identifier hs-var">foods</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679039034"><span class="hs-identifier hs-var">len</span></a><span class="hs-operator hs-var">*</span><span class="hs-number">2</span><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span></span><span>
</span><a name="line-107"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679039028"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Framework.html#numberParseTag"><span class="hs-identifier hs-var">numberParseTag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span></span><span>
</span><a name="line-108"></a><span>         </span><a href="Framework.html#parseNumber"><span class="hs-identifier hs-var">parseNumber</span></a><span> </span><a href="#local-6989586621679039025"><span class="hs-identifier hs-var">pid</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-109"></a><span>         </span><a href="Framework.html#parseGameData"><span class="hs-identifier hs-var">parseGameData</span></a><span> </span><a href="#local-6989586621679039025"><span class="hs-identifier hs-var">pid</span></a><span> </span><a href="#local-6989586621679039026"><span class="hs-identifier hs-var">players</span></a><span> </span><a href="#local-6989586621679039027"><span class="hs-identifier hs-var">foods</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679039029"><span class="hs-identifier hs-var">xs</span></a><span></span><span>
</span><a name="line-110"></a><span class="hs-identifier">parseGameData</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Caught data with empty&quot;</span><span></span><span>
</span><a name="line-111"></a></pre></body></html>